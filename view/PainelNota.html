<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/style_nt.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <title>Document</title>
    <style>
      table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      td,
      th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
      }

      tr:nth-child(even) {
        background-color: #dddddd;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img
            src="css/img/logo.png"
            alt="Avatar Logo"
            style="width: 40px"
            class="rounded-pill"
          />
        </a>
        <a class="navbar-brand" href="#">Uni-Class</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapsibleNavbar"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="#" id="btnHome">home</a>
            </li>
          </ul>
        </div>
        <div id="divPainel" style="color: white"></div>
      </div>
    </nav>

    <div id="divResposta" style="padding-left: 30px; padding-top: 30px"></div>
    <div style="padding-left: 30px; padding-top: 10px">
      <button type="button" class="btn btn-secondary" id="btnVoltar">Voltar</button>
    </div>

    <div class="container mt-5">
      <div class="row" id="container">
        <div class="col-sm-4">
          <div class="card bg-secondary text-white" style="width: 400px">
            <div class="card-body">
              <h4 class="card-title">Add Nota</h4>
              <p class="card-text">
                O processo de adicionar uma disciplina faz com que se possa
                realizar a inserção de turmas e notas a partir desta
              </p>
              <button
                type="button"
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#modalNota"
              >
                Criar
              </button>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="card bg-secondary text-white" style="width: 400px">
            <div class="card-body">
              <h4 class="card-title">Add Aluno</h4>
              <p class="card-text">
                O processo de adicionar um aluno faz com que se possa realizar a
                inserção de alunos e notas a partir desta
              </p>
              <button
                type="button"
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#modalAluno"
              >
                Criar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <br /><br />

    <div class="container mt-3">
      <h2>Notas:</h2>
      <table class="table table-dark table-striped" id="tabela" >
        <tr>
          <th>ID Nota</th>
          <th>Matrícula do Aluno</th>
          <th>Bimestre</th>
          <th>Nota</th>
          <th>Última Alteração</th>
          <th>Tipo de Nota</th>
          <th>Fez Lista</th>
          <th>Atualizar</th>
          <th>Selecionar</th>
        </tr>
      </table>
    </div>

    <div class="container mt-5">
      <div class="row" id="container">
        <div class="col-sm-4">
          <div class="card bg-secondary text-white" style="width: 400px">
            <div class="card-body">
              <div class="input-line-container">
                <span class="name-input">ID Nota</span>
                <input type="text" id="txtIdNota" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Matricula do aluno</span>
                <input type="text" id="txtMatricula" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Bimestre</span>
                <input type="text" id="txtBimestre" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Nota</span>
                <input type="text" id="txtNota" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Ultima Alteracao</span>
                <input type="text" id="txtUltima" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Tipo de Nota</span>
                <input type="text" id="txtTipoNota" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Fez Lista</span>
                <input type="text" id="txtLista" class="input-line" id="" />
              </div>
              <button type="button" class="btn btn-warning" id="btnAtualizar">
                Atualizar
              </button>
              <button type="button" class="btn btn-danger" id="btnDeleteNota">Excluir</button>
            </div>
          </div>
        </div>
        <div class="col-sm-8">
          <h2>Alunos:</h2>
          <table class="table table-dark table-striped">
            <thead>
              <tr>
                <th>Matrícula</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Selecionar</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Os dados da tabela serão inseridos aqui dinamicamente com JavaScript -->
            </tbody>
          </table>
          <div class="card bg-secondary text-white">
            <div class="card-body">
              <div class="input-line-container">
                <span class="name-input">Matricula</span>
                <input type="text" id="txtMatricula_aluno_atualizar" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Nome</span>
                <input type="text" id="txtNome_aluno_atualizar" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Email</span>
                <input type="text" id="txtEmail_aluno_atualizar" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Senha</span>
                <input type="text" id="txtSenha_aluno_atualizar" class="input-line" id="" />
              </div>
              <div class="input-line-container">
                <span class="name-input">Wpp</span>
                <input type="text" id="txtWpp_aluno_atualizar" class="input-line" id="" />
              </div>
              <button type="button" class="btn btn-warning" id="btnUpdateAluno">
                Atualizar
              </button>
              <button type="button" class="btn btn-danger" id="btnDeleteAluno">Excluir</button>
            </div>
        </div>
      </div>
    </div>

    <!-- MODAL DA NOTA -->

    <!-- The Modal -->
    <div class="modal fade" id="modalNota">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Cadastrar uma Disciplina</h4>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <div class="input-line-container">
              <span class="name-input">Matricula do aluno</span>
              <input
                type="text"
                id="txtMatriculaCreate_nota"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Bimestre</span>
              <input
                type="text"
                id="txtBimestreCreate_nota"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Nota</span>
              <input
                type="text"
                id="txtNotaCreate_nota"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Ultima Alteracao</span>
              <input
                type="text"
                id="txtUltimaCreate_Nota"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Tipo de Nota</span>
              <input
                type="text"
                id="txtTipoNotaCreate_nota"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Fez Lista</span>
              <input
                type="text"
                id="txtListaCreate_nota"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-success"
              data-bs-dismiss="modal"
              id="btnCreateNota"
            >
              Criar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- The Modal -->
    <div class="modal fade" id="modalAluno">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Cadastrar um(a) Aluno(a)</h4>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <div class="input-line-container">
              <span class="name-input">Matricula do aluno</span>
              <input
                type="text"
                id="txtMatricula_aluno"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Nome do Aluno</span>
              <input
                type="text"
                id="txtNome"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Email</span>
              <input
                type="text"
                id="txtEmail"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Wpp</span>
              <input
                type="text"
                id="txtWpp"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
            <div class="input-line-container">
              <span class="name-input">Senha</span>
              <input
                type="text"
                id="txtSenha"
                class="input-line"
                style="border-bottom: 2px solid black; color: black"
              />
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-success"
              data-bs-dismiss="modal"
              id="btnCreateAluno"
            >
              Criar
            </button>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="/js/aluno.js"></script>
    <script type="text/javascript" src="/js/nota.js"></script>
    <script type="text/javascript" src="/js/botoes.js"></script>
    <script>
      window.onload = function () {
        // Recupera os dados do localStorage
        var dadosDisciplinaString = localStorage.getItem("dadosDisciplina");

        // Verifica se há dados no localStorage
        if (dadosDisciplinaString != "") {
          // Converte a string JSON de volta para um objeto JavaScript
          var dadosDisciplina = JSON.parse(dadosDisciplinaString);

          // Recupera o nome da turma
          var idDisciplina = dadosDisciplina.disciplina.idDisciplina;
        }

        const uri = "/nota/disciplina/" + idDisciplina;

        const requisicao_assincrona = fetch(uri, {
          method: "get",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
            Authorization: "",
          },
        });

        requisicao_assincrona
          .then((response) => {
            return response.json();
          })
          .then((objetoJson) => {
            if (objetoJson.status === true) {
              const dados = objetoJson.dados;

              criarTabela(dados); // Chama a função para gerar a tabela dinamicamente
            } else {
              console.log("deu ruim");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });

        //aqui se inicia a requisicao da tabela de alunos

        const uri_aluno = "/aluno";
        const requisicao_assincrona_aluno = fetch(uri_aluno, {
          method: "get",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
          },
        });

        requisicao_assincrona_aluno
          .then((response) => {
            return response.json();
          })
          .then((objetoJson) => {
            if (objetoJson.status === true) {
              const dados = objetoJson.dados;

              // Limpa a tabela antes de adicionar novos dados
              document.getElementById("tableBody").innerHTML = "";
              criarTabela_Aluno(dados); // Chama a função para gerar a tabela dinamicamente
            } else {
              console.log("deu ruim");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      };

      // Restante do seu código JavaScript aqui
      function criarTabela_Aluno(dados) {
        var tableBody = document.getElementById("tableBody");

        dados.forEach(function (aluno) {
          var row = tableBody.insertRow();
          var cellMatricula = row.insertCell(0);
          var cellNome = row.insertCell(1);
          var cellEmail = row.insertCell(2);

          cellMatricula.textContent = aluno.matricula;
          cellNome.textContent = aluno.nome;
          cellEmail.textContent = aluno.email;

          // Adiciona uma célula para o botão
          var cellButton = row.insertCell(3);
          var btnDetalhes = document.createElement("button");
          btnDetalhes.textContent = "Detalhes";
          btnDetalhes.classList.add("btn", "btn-info");
          btnDetalhes.addEventListener("click", function () {
            handleDetalhesButtonClick(aluno);
          });
          cellButton.appendChild(btnDetalhes);
        });
      }

      // Função para lidar com o clique do botão Detalhes
      function handleDetalhesButtonClick(aluno) {
        console.log("Detalhes do Aluno:", aluno);

        // Preenche os campos de entrada com os valores da linha clicada
        document.getElementById("txtMatricula_aluno_atualizar").value = aluno.matricula;
        document.getElementById("txtNome_aluno_atualizar").value = aluno.nome;
        document.getElementById("txtEmail_aluno_atualizar").value = aluno.email;
        document.getElementById("txtWpp_aluno_atualizar").value = aluno.wpp;
      }

      // Função para criar a tabela dinâmica
      function criarTabela(dados) {
        const tabela = document.getElementById("tabela");

        dados.forEach((item) => {
          const row = tabela.insertRow();

          // Adiciona a coluna ID Nota
          const cellIdNota = row.insertCell();
          cellIdNota.textContent = item.idNota;

          // Adiciona as demais colunas
          for (const key in item) {
            const cell = row.insertCell();
            cell.textContent = item[key];
          }

          // Adiciona a coluna de botões
          const cellBotoes = row.insertCell();
          const btnAtualizar = document.createElement("button");
          btnAtualizar.textContent = "Atualizar";
          btnAtualizar.classList.add("btn", "btn-warning");
          btnAtualizar.addEventListener("click", function () {
            // Chama a função para lidar com o clique do botão Atualizar e passa os dados da linha
            handleAtualizarButtonClick(item);
          });
          cellBotoes.appendChild(btnAtualizar);
        });
      }

      // Função para lidar com o clique do botão Atualizar
      function handleAtualizarButtonClick(item) {
        console.log("Dados da linha:", item);

        // Preenche os campos de entrada com os valores da linha clicada
        document.getElementById("txtIdNota").value = item.idNota;
        document.getElementById("txtMatricula").value = item.Aluno_matricula;
        document.getElementById("txtBimestre").value = item.bimestre;
        document.getElementById("txtNota").value = item.nota;

        var dataString = item.ultimaAlteracao;

        dataString = dataString.slice(0, 10);

        document.getElementById("txtUltima").value = dataString;
        document.getElementById("txtTipoNota").value = item.tipoNota;
        document.getElementById("txtLista").value = item.fezLista;

        // Aqui você pode realizar a lógica necessária para atualizar os dados ou executar outras ações
      }
    </script>
  </body>
</html>
